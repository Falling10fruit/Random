<!DOCTYPE html>
<html lang = "en">
    <head>
        <meta charset="character_set">

        <title>Number AI detector</title>

        <style>
            body {
                font-family: sans-serif;
                display: flex;
                flex-direction: column;
                justify-content: space-around;
                align-items: center;
            }

            table {
                border-collapse: collapse;
            }

            .Box {
                border: 2px solid black;
            }

            .Control {
                display: flex;
                justify-content: space-around;
            }

            #Expand {
                -webkit-user-select: none;
                -ms-user-select: none;
                user-select: none;
                cursor: pointer;
            }

            p {
                line-height: 1.5;
            }
        </style>
    </head>
    <body>
        <h1 style="margin: 0px; font-size: 50px;">I make AI</h1>

        <p style="text-align: center; margin: 0px">Go draw numbers from 0 to 9</p>

        <p id="AIGuess" style="margin: 0px">Waiting for input...</p>

        <table>
            <tbody id="Drawing">
            </tbody>
        </table>

        <div class="Control">
            <button type="button" id="Correct">AI correct</button>
            <button type="button" id="Wrong">AI stupid</button>
            <button type="button" id="Reset">Begone ugly drawing</button>
        </div>

        <div class="Control">
            <button type="button" id="Save">SAVE AI brain</button>
            <button type="button" id="Restart">Restart SAVE</button>
            <button type="button" id="Train">Auto train</button>
        </div>

        <div id="Explain">
            <h1 id="Expand">How does it train?</h1>

            <div id="Explanation">
                <p>So basically, I copy the main AI brain and made 20 of them that are slightly different. And then when you tell whether the AI is right or wrong, you are actually judging the first of the 20 brain's work.
                <br>
                <br>If correct, it will <del>kill</del> delete those that are not the same with the first Brain's answer because they are all retarded <del>like me</del>.
                <br>
                <br>If wrong, then any Brain with the same answer will <del>die</del> be deleted. Obviously, there is a flaw in this bit beause other brains might also get it wrong, but I on't have enough UI space to put in the <i>"So what's the answer"</i> question, plus, I'd be really lazy as the user to always press <strong>one</strong> key.
                <br>
                <br>After <i>le brains</i> are <del>murdered</del> <strong>peacefully</strong> dispatched, the first surviving brain will be saved as the main AI and the brains will be regenerated from the surviving brains to fill up the 20 brains as before.
                <br>
                <br>This means that the <strong>SAVED</strong> AI Brain <i>ironically</i> does nothing, instead, it's job is to exist as the foundation of the first generation and become the model of the next generations when the AI Brain gets <strong>SAVED</strong>. I <i>could</i> and probably <u>should</u> optimize this because each brain has like 210 neurons and over dozens of thousands of connections and deleting this <i>useless idling</i> brain <strong>would</strong> help a lot with memory space</p>

                <h3>Why talk about training rather than the inner workings of the AI?</h3>
                
                <p>If you really want to but it also means that I can't have a fitness level, there is no <i>"You ran faster than average"</i> or <i>"My cat can program a better algorithm"</i>. There is only <span style="color: greenyellow">YES</span> or <span style="color: red">NO</span>, plus you can't automatically know Brain is doing well. There used to be other problems like having a limited imagination but it seems a little off after knowing the bad solution.</p>
            </div>
        </div>

        <script>
            // Setting up body width and margin
            document.body.style.margin = window.innerHeight*0.05 + "px";
            document.body.style.height = window.innerHeight*0.90 + "px";


            // Create Boxes
            for (var i = 0; i < 20; i++) {
                var tr = document.createElement("tr");
                document.getElementById("Drawing").appendChild(tr);
                for (var x = 0; x < 20; x++) {
                    var td = document.createElement("td");
                    td.className = "Box";
                    tr.appendChild(td);
                }
            }

            // Setting Boxes width
            var Boxes = document.getElementsByClassName("Box");

            if (window.innerHeight < window.innerWidth) {
                for (var i = 0; i < Boxes.length; i++) {
                    Boxes[i].style.width = Boxes[i].style.height = window.innerWidth/100 + "px";
                }
            } else {
                for (var i = 0; i < Boxes.length; i++) {
                    Boxes[i].style.width = Boxes[i].style.height = window.innerWidth/100 + "px";
                }
            }

            // Seting up Scene data
            var Scene = [];

            for (var i = 0; i < 20; i++) {
                Scene.push([]);
                for (var x = 0; x < 20; x++) {
                    Scene[i].push(0);
                }
            }

            // Setting auto train data for me to later edit
            if (window.localStorage.getItem("TrainedData") == null) {
                window.localStorage.setItem("TrainedData", []);
                var TrainedData = window.localStorage.getItem("TrainedData");
            } else {
                var TrainedData = window.localStorage.getItem("TrainedData");
            }


            window.addEventListener("keypress", function (e) {
                if (e.key == "s") {
                    TrainedData.push(Scene);
                    window.localStorage.setItem("TrainedData")
                }
            });

            // Create AI brain
            if (window.localStorage.getItem("SAVEBrain") == null) {
                var Brain = [];

                for (var i = 0; i < 3; i++) { // Two hidden layers and one output layer
                    Brain.push([]);
                    if (i < 2) {
                        for (var x = 0; x < 100; x++) { // 100 Neurons
                            Brain[i].push({
                                Weighs: [],
                                Storage: 0
                            });

                            if (i < 1) {
                                for (var y = 0; y < Boxes.length; y++) { // Connections for first layer
                                    Brain[i][x].Weighs.push(Math.random() * (Math.floor(Math.random() * 3) - 1) + Math.random() * (Math.floor(Math.random() * 3) - 1));
                                }
                            } else {
                                for (var y = 0; y < Brain[i - 1].length; y++) { // Connections
                                    Brain[i][x].Weighs.push(Math.random() * (Math.floor(Math.random() * 3) - 1) + Math.random() * (Math.floor(Math.random() * 3) - 1));
                                }
                            }
                        }
                    } else {
                        for (var x = 0; x < 10; x++) { // 10 output Neurons
                            Brain[i].push({
                                Weighs: [],
                                Storage: 0
                            });

                            for (var y = 0; y < Brain[i - 1].length; y++) { // Connections
                                Brain[i][x].Weighs.push(Math.random() * (Math.floor(Math.random() * 3) - 1) + Math.random() * (Math.floor(Math.random() * 3) - 1));
                            }
                        }
                    }
                }
            } else {var Brain = window.localStorage.getItem("SAVEBrain");}

            // Training
            var Brains = [];
            for (var i = 0; i < 20; i++) { // Generate 20 brains
                Brains.push(Brain);

                for (var x = 0; x < Brains[i].length; x++) { // Layers
                    for (var y = 0; y < Brains[i][x].length; y++) { // Neurons
                        for (var z = 0; z < Brains[i][x][y].Weighs.length; z++) { // Weighs
                            if (Math.floor(Math.random * 100) == 0) {
                                Brains[i][x][y].Weighs[z] += Math.random * 3;
                            }
                        }
                    }
                }
            }

            // AI Brains in action
            var Draw = function (Box) {
                Scene[Math.floor(Box/20)][Box%20] = 1;
                Boxes[Box].style.backgroundColor = "rgb(0, 0, 0)";

                // Resseting the brains
                for (let i = 0; i < Brains.length; i++) { // Brains
                    for (let x = 0; x < Brains[i].length; x++) { // Layers
                        for (let y = 0; y < Brains[i][x].length; y++) { // Neurons
                            Brains[i][x][y].Storage = 0;
                        }
                    }
                }

                // Running the brains
                for (let i = 0; i < Brains.length; i++) { // Brains
                    for (let x = 0; x < Brains[i].length; x++) { // Layers
                        for (let y = 0; y < Brains[i][x].length; y++) { // Neurons
                            if (x < 1) {
                                for (let z = 0; z < Boxes.length; z++) { // Weighs for first layer
                                    Brains[i][x][y].Storage += Brains[i][x][y].Weighs[z] * Scene[Math.floor(z/20)][z%20];
                                }
                            } else {
                                for (let z = 0; z < Brains[i][x - 1].length; z++) { // Weighs
                                    Brains[i][x][y].Storage += Brains[i][x][y].Weighs[z] * Brains[i][x - 1][y].Storage;
                                }
                            }
                        }

                    }
                }

                // Reading First brain output
                var AIGuess = [0, 0];

                
                for (var i = 0; i < Brains[0][Brains[0].length - 1].length; i++) { // First brain's output layer's neurons
                    if (Math.round(Brains[0][Brains[0].length - 1][i].Storage) > AIGuess[0]) {
                        AIGuess[0] = Math.round(Brains[0][Brains[0].length - 1][i].Storage);
                        AIGuess[1] = x;
                    }

                    console.log(i + ": " + Math.round(Brain[Brain.length - 1][i].Storage));
                }

                var AIGuessTxt = document.getElementById("AIGuess");
                AIGuessTxt.innerText = "The AI guesses: " + AIGuess[1];
            }

            var AICorrect = function () {
                // Find AI's Answer
                var AIGuess = [0, 0];
                
                for (var i = 0; i < Brains[0][Brains[0].length - 1].length; i++) { // First brain's output layer's neurons
                    if (Math.round(Brains[0][Brains[0].length - 1][i].Storage) > AIGuess[0]) {
                        AIGuess[0] = Math.round(Brains[0][Brains[0].length - 1][i].Storage);
                        AIGuess[1] = i;
                    }
                }

                //Find all other Brain's answers
                var BrainGuess = [0, 0];

                for (var i = 0; i < Brains.length; i++) { // Check every Brain
                    for (var x = 0; x < Brain[i][Brain[i].length - 1].length; x++) { // Check Brain's output layer's neurons 
                        if (Math.round(Brains[i][Brains[i].length - 1][x].Storage) > AIGuess[0]) {
                            BrainGuess[0] = Math.round(Brains[i][Brains[i].length - 1].Storage);
                            BrainGuess[1] = x;
                        }
                    }

                    if (BrainGuess[1] != AIGuess) { // Kill brain if brain wrong
                        Brains.splice(i, 1);
                    }
                }

                //Regenerate Brains
                for (var i = 0; Brains.length < 20; i++) {
                    Brains.push(Brains[20 - 20%i]);

                    for (var x = 0; x < Brains[Brains.length - 1].length; x++) { // Layers of newly created brain
                        for (var y = 0; y < Brains[Brains.length - 1][x].length; y++) { // Neurons
                            for (var z = 0; z < Brains[Brains.length - 1][x][y].length; z++) { // Weighs
                                Brains[Brains.length - 1][x][y].Weighs[z] += Math.random * (Math.floor(Math.random*3 - 1));
                            }
                        }
                    }
                }
            }

            var AIWrong = function () {
                // Find first Brain's 
                var AIGuess = [0, 0];
                
                for (var i = 0; i < Brains[0][Brains[0].length - 1].length; i++) { // First brain's output layer's neurons
                    if (Math.round(Brains[0][Brains[0].length - 1][i].Storage) > AIGuess[0]) {
                        AIGuess[0] = Math.round(Brains[0][Brains[0].length - 1][i].Storage);
                        AIGuess[1] = i;
                    }
                }

                Brains.splice(0, 1); // Kill first Brain 'cause wrong

                // Find other Brain's anwers
                var BrainGuess = [0, 0];

                for (var i = 0; i < Brains.length; i++) { // Brains
                    for  (var x = 0; x < Brains[i][Brains[i].length - 1].length; x++) { // Neurons at output layer
                        if (Math.round(Brains[i][Brains[i].length - 1][x].Storage) > BrainGuess[0]) {
                            BrainGuess[0] = Math.round(Brains[i][Brains[i].length - 1][x].Storage);
                            BrainGuess[1] = x;
                        }         
                    }

                    if (AIGuess[1] == BrainGuess[1]) { // Kill if wrong
                        Brains.splice(i, 1);
                    }
                }

                //Regenerate Brains
                for (var i = 0; Brains.length < 20; i++) {
                    Brains.push(Brains[20 - 20%i]);

                    for (var x = 0; x < Brains[Brains.length - 1]; x++) {
                        for (var y = 0; y < Brains[Brains.length - 1][x]; y++) {
                            for (var z = 0; z < Brains[Brains.length - 1][x][y].Weighs.length; z++) {
                                Brains[Brains.length.length - 1][x][y].Weighs[z] += Math.random * (Math.floor(Math.random*3 - 1));
                            }
                        }
                    }
                }
            }

            //Clear drawing
            var Clear = function () {
                for (var i = 0; i < Boxes.length; i++) {
                    Boxes[i].style.backgroundColor = "rgb(255, 255, 255)";
                }

                for (var i = 0; i < Scene.length; i++) {
                    for (var x = 0; x < Scene[i].length; x++) {
                        Scene[i][x] = 0;
                    }
                }

                document.getElementById("AIGuess").innerText = "Waiting for input...";
            }

            for (let i = 0; i < Boxes.length; i++) {
                Boxes[i].setAttribute("draggable", false);
                Boxes[i].addEventListener("mousedown", function (e) {
                    Draw(i);
                });
            }

            document.getElementById("Correct").addEventListener("click", AICorrect);

            document.getElementById("Wrong").addEventListener("click", AIWrong);

            document.getElementById("Reset").addEventListener("click", Clear);

            document.getElementById("Save").addEventListener("click", function (e) {
                window.localStorage.setItem("SAVEBrain", Brain);
            });

            document.getElementById("Restart").addEventListener("click", function (e) {
                window.localStorage.removeItem("SAVEBrain");
            });

            /*document.getElementById("Train").addEventListener("click", function (e) {
                for (var i = 0; i < TrainedData.length; i++) {
                    Scene = TrainedData[i];
                }
            }); I forgot that there is no answer key to this*/

            // Esplanation stuff
            var Explain = document.getElementById("Explain");
            Explain.style.position = "fixed";
            Explain.style.width = window.innerWidth/4 + "px";
            Explain.style.left = (document.getElementById("Drawing").getBoundingClientRect().left - Explain.getBoundingClientRect().width)/2 + "px";

            var Explanation = document.getElementById("Explanation");
            Explanation.style.height = "0px";
            Explanation.style.overflow = "auto";

            var Expanding = function () {
                Explanation.style.height = parseFloat(Explanation.style.height) + (window.innerHeight/4*3 - parseFloat(Explanation.style.height))/10 + 25 + "px";

                if (parseFloat(Explanation.style.height) < window.innerHeight/4*3) {
                    window.requestAnimationFrame(Expanding);
                } else {
                    Explanation.style.height = window.innerHeight/4*3 + "px";
                }
            }

            var Collapsing = function () {
                Explanation.style.height = parseFloat(Explanation.style.height) + (0 - parseFloat(Explanation.style.height))/10 + "px";

                if (parseFloat(Explanation.style.height) > 1) {
                    window.requestAnimationFrame(Collapsing);
                } else {
                    Explanation.style.height = "0px";
                }
            }

            var Expand = document.getElementById("Expand");
            Expand.addEventListener("click", function (e) {
                if (Explanation.style.height == window.innerHeight/4*3 + "px") {
                    Collapsing();
                } else {
                    Expanding();
                }
            });

            Expand.addEventListener("mouseenter", function (e) {
                Expand.style.color = "rgb(125, 125, 125)";
            });

            
            Expand.addEventListener("mouseleave", function (e) {
                Expand.style.color = "rgb(0, 0, 0)";
            });

            Expand.addEventListener("mousedown", function (e) {
                Expand.style.color = "rgb(75, 75, 75)";
            });
        </script>
    </body>
</html>