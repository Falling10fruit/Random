<!DOCTYPE html>
<html lang = "en">
    <head>
        <meta charset="character_set">

        <title>Number AI detector</title>

        <style>
            body {
                font-family: sans-serif;
                display: flex;
                flex-direction: column;
                justify-content: space-around;
                align-items: center;
            }

            table {
                border-collapse: collapse;
            }

            .Box {
                border: 2px solid black;
            }

            #Div {
                display: flex;
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
        </style>
    </head>
    <body>
        <h1 style="margin: 0px">I make AI</h1>

        <p style="text-align: center; margin: 0px">Go draw numbers from 0 to 9</p>

        <p id="AIGuess" style="margin: 0px">Waiting for input...</p>

        <table>
            <tbody id="Drawing">
            </tbody>
        </table>

        <div id="Control">
            <button type="button" id="Correct">AI correct</button>
            <button type="button" id="Wrong">AI stupid</button>
            <button type="button" id="Reset">Begone ugly drawing</button>
        </div>

        <button type="button" id="Save">SAVE AI brain</button>

        <script>
            // Setting up body width and margin
            document.body.style.margin = window.innerHeight*0.05 + "px";
            document.body.style.height = window.innerHeight*0.90 + "px";

            // Create Boxes
            for (var i = 0; i < 20; i++) {
                var tr = document.createElement("tr");
                document.getElementById("Drawing").appendChild(tr);
                for (var x = 0; x < 20; x++) {
                    var td = document.createElement("td");
                    td.className = "Box";
                    tr.appendChild(td);
                }
            }

            // Setting Boxes width
            var Boxes = document.getElementsByClassName("Box");

            if (window.innerHeight < window.innerWidth) {
                for (var i = 0; i < Boxes.length; i++) {
                    Boxes[i].style.width = Boxes[i].style.height = window.innerWidth/100 + "px";
                }
            } else {
                for (var i = 0; i < Boxes.length; i++) {
                    Boxes[i].style.width = Boxes[i].style.height = window.innerWidth/100 + "px";
                }
            }

            // Seting up Scene data
            var Scene = [];

            for (var i = 0; i < 20; i++) {
                Scene.push([]);
                for (var x = 0; x < 20; x++) {
                    Scene[i].push(0);
                }
            }

            // Create AI brain
            if (window.localStorage.getItem("SAVEBrain") == null) {
                var Brain = [];

                for (var i = 0; i < 2; i++) { // One hidden layer and one output
                    Brain.push([]);
                    for (var x = 0; x < 10; x++) { // 10 Neurons
                        Brain[i].push({
                            Weighs: [],
                            Storage: 0
                        });

                        if (i < 1) {
                            for (var y = 0; y < Boxes.length; y++) { // Connections
                                Brain[i][x].Weighs.push(Math.random() * (Math.floor(Math.random() * 3) - 1) + Math.random() * (Math.floor(Math.random() * 3) - 1));
                            }
                        } else {
                            for (var y = 0; y < Brain[i - 1].length; y++) { // Connections
                                Brain[i][x].Weighs.push(Math.random() * (Math.floor(Math.random() * 3) - 1) + Math.random() * (Math.floor(Math.random() * 3) - 1));
                            }
                        }
                    }
                }
            } else {var Brain = window.localStorage.getItem("SAVEBrain");}

            // AI Brain in action
            var Draw = function (Box) {
                Scene[Math.floor(Box/20)][Box%20] = 1;
                Boxes[Box].style.backgroundColor = "rgb(0, 0, 0)";

                // Resseting the brain
                for (let i = 0; i < Brain.length; i++) { // Layers
                    for (let x = 0; x < Brain[i].length; x++) { // Neurons
                        Brain[i][x].Storage = 0;
                    }
                }

                // Running the brain
                for (let i = 0; i < Brain.length; i++) { // Layers
                    for (let x = 0; x < Brain[i].length; x++) { // Neurons
                        if (i < 1) {
                            for (let y = 0; y < Boxes.length; y++) {
                                Brain[i][x].Storage += Brain[i][x].Weighs[y] * Scene[Math.floor(y/20)][y%20];
                            }
                        } else {
                            for (let y = 0; y < Brain[i - 1].length; y++) {
                                Brain[i][x].Storage += Brain[i][x].Weighs[y] * Brain[i - 1][y].Storage;
                            }
                        }
                    }
                }

                // Reading Brain output
                var AIGuess = [0][0];

                for (var i = 0; i < Brain[Brain.length - 1].length; i++) {
                    if (Math.round(Brain[Brain.length - 1][i].Storage) > AIGuess[0]) {
                        AIGuess[1] = i;
                    }

                    console.log(i + ": " + Math.round(Brain[Brain.length - 1][i].Storage));
                }

                var AIGuessTxt = document.getElementById("AIGuess");
                AIGuessTxt.innerText = "The AI guesses: " + AIGuess[1];
            }

            //Clear drawing
            var Clear = function () {
                for (var i = 0; i < Boxes.length; i++) {
                    Boxes[i].style.backgroundColor = "rgb(255, 255, 255)";
                }

                for (var i = 0; i < Scene.length; i++) {
                    for (var x = 0; x < Scene[i].length; x++) {
                        Scene[i][x] = 0;
                    }
                }

                document.getElementById("AIGuess").innerText = "Waiting for input...";
            }

            for (let i = 0; i < Boxes.length; i++) {
                Boxes[i].setAttribute("draggable", false);
                Boxes[i].addEventListener("mousedown", function (e) {
                    Draw(i);
                });
            }

            document.getElementById("Reset").addEventListener("click", Clear);

            // SAVE AI brain
            document.getElementById("Save").addEventListener("click", function (e) {
                window.localStorage.setItem("SAVEBrain", Brain);
                AnimProgress = 100;
            });
        </script>
    </body>
</html>