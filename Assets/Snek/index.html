<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Snek</title>
        <style>
            body {
                margin: 4%;
                font-family: sans-serif;
                display: flex;
                align-items: center;
                justify-content: center;
                flex-direction: column;
            }

            table {
                border-collapse: collapse;
            }

            .Box {
                border: 3px solid black;
            }
        </style>
    </head>
    <body>
        <h1 style="font-size: 2cm; margin-top: 5px; margin-bottom: 5px"><strong>Snek</strong></h1>
        <table>
            <tbody id="Grid">
            </tbody>
        </table>

        <button id="Start" type="button" style="margin-top: 2%; ">Start</button>

        <script>
            // Setting up boxes
            for (var i = 0; i < 15; i++) {
                var tr = document.createElement("tr");
                document.getElementById("Grid").appendChild(tr);

                for (var x = 0; x < 15; x++) {
                    var td = document.createElement("td");
                    td.className = "Box";
                    tr.appendChild(td);
                    console.log("Box created");
                }
            }

            //Styling boxes
            var Boxes = document.getElementsByClassName("Box");

            if (window.innerHeight < window.innerWidth) {
                for (var i = 0; i < Boxes.length; i++) {
                    Boxes[i].style.width = Boxes[i].style.height = window.innerWidth/50 + "px";
                }
            } else {
                for (var i = 0; i < Boxes.length; i++) {
                    Boxes[i].style.width = Boxes[i].style.height = window.innerWidth/50 + "px";
                }
            }

            /*
            Going by the order of "Easiest to code theoretically"
            0: Nothing
            1: Snake's body
            2: Snake head
            3: Food
            */

            var Scene = []; // Data about the grid

            for (var i = 0; i < 15; i++) {
                Scene.push([]);
                for (var x = 0; x < 15; x++) {
                    Scene[Scene.length - 1].push(0);
                };
            };

            Scene[7][7] = 2; // Set the head to center

            var TailLength = 0;
            var Tails = [{
                Row: 8,
                Column: 7
            }];
            var Direction = "w";

            console.log(Scene);

            // Main part - Infinite loop
            var Game = function () {
                const Play = setTimeout(function(){
                    window.addEventListener("keypress", function (e) { // Change direction
                        if (e.key == "w") {
                            Direction = "w";
                        } else if (e.key == "a") {
                            Direction = "a";
                        } else if (e.key == "s") {
                            Direction = "s";
                        } else if (e.key == "d") {
                            Direction = "d";
                        }
                        console.log(Direction);
                    });

                    for (var i = 0; i < Scene.length; i++) {
                        for (var x = 0; x < Scene[i].length; x++) {
                            if (Scene[i][x] == 2) {
                                if (Direction == "w") {
                                    if (!(i == 0)) { 
                                        Scene[i - 1][x] = 2;
                                    } else {
                                        Scene[Scene.length - 1][x] = 2;
                                    }
                                    Scene[i][x] = 1
                                } else if (Direction == "a") {
                                    Scene[i - 1][x] = 2;
                                    Scene[i][x] = 1
                                } else if (Direction == "s") {
                                    Scene[i - 1][x] = 2;
                                    Scene[i][x] = 1
                                } else if (Direction == "d") {
                                    Scene[i - 1][x] = 2;
                                    Scene[i][x] = 1
                                }

                                x = Scene[i].length;
                                i = Scene.length - 1;
                            }
                        }
                    }

                    if (Tails.length > TailLength) { // Destroy end of tail if too long
                        Scene[Tails[0].Row][Tails[0].Column] == 0; // Replace with white
                        Tails.splice(0, 1);
                    };

                    for (var i = 0; i < Tails.length; i++) { // Make tails
                        Scene[Tails[i].Row][Tails[i].Column] = 1; // Paint square by Tail'sz coordinate
                        console.log("Tail");
                    };

                    for (var i = 0; i < 15; i++) { // Coloring
                        for (var x = 0; x < 15; x++) {
                            if (Scene[i][x] == 0) {
                                Boxes[i * 15 + x].style.backgroundColor = "white";
                            } else if (Scene[i][x] == 1) {
                                Boxes[i * 15 + x].style.backgroundColor = "yellow";
                            } else if (Scene[i][x] == 2) {
                                Boxes[i * 15 + x].style.backgroundColor = "green";
                            } else if (Sceme[i][x] == 3) {
                                Boxes[i * 15 + x].style.backgroundColor = "red";
                            }
                        };
                    };
                }, 1000);
            }

            document.getElementById("Start").addEventListener("click", Game);
        </script>
    </body>
</html>