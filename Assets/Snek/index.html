<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Snek</title>
        <style>
            body {
                margin: 4%;
                font-family: sans-serif;
                display: flex;
                align-items: center;
                justify-content: center;
                flex-direction: column;
            }

            table {
                border-collapse: collapse;
            }

            .Box {
                border: 3px solid black;
            }
        </style>
    </head>
    <body>
        <h1 style="font-size: 2cm; margin-top: 5px; margin-bottom: 5px"><strong>Snek</strong></h1>
        <table>
            <tbody id="Grid">
            </tbody>
        </table>

        <button id="Start" type="button" style="margin-top: 2%; ">Start</button>

        <script>
            // Setting up boxes
            for (var i = 0; i < 15; i++) {
                var tr = document.createElement("tr");
                document.getElementById("Grid").appendChild(tr);

                for (var x = 0; x < 15; x++) {
                    var td = document.createElement("td");
                    td.className = "Box";
                    tr.appendChild(td);
                    console.log("Box created");
                }
            }

            //Styling boxes
            var Boxes = document.getElementsByClassName("Box");

            if (window.innerHeight < window.innerWidth) {
                for (var i = 0; i < Boxes.length; i++) {
                    Boxes[i].style.width = Boxes[i].style.height = window.innerWidth/50 + "px";
                }
            } else {
                for (var i = 0; i < Boxes.length; i++) {
                    Boxes[i].style.width = Boxes[i].style.height = window.innerWidth/50 + "px";
                }
            }

            /*
            Going by the order of "Easiest to code theoretically"
            0: Nothing
            1: Snake's body
            2: Snake head
            3: Food
            */

            var Scene = []; // Data about the grid

            for (var i = 0; i < 15; i++) { // Create said data
                Scene.push([]);
                for (var x = 0; x < 15; x++) {
                    Scene[Scene.length - 1].push(0);
                };
            };

            Scene[7][7] = 2; // Set the head to center

            var TailLength = 0;
            var Tails = [/*{ Example to stupid fat forgetful creator
                Row: 8,
                Column: 7
            }*/];
            var Direction = "w";
            var CreateFood = function () {
                var i = Math.floor(Math.random() * Scene.length);
                var x = Math.floor(Math.random() * Scene[i].length);

                while (Scene[i][x] != 0) {
                    i = Math.floor(Math.random() * Scene.length);
                    x = Math.floor(Math.random() * Scene[i].length);
                }

                Scene[i][x] = 3;
            };
            CreateFood();

            console.log(Scene);

            for (var i = 0; i < 15; i++) { // Coloring
                for (var x = 0; x < 15; x++) {
                    if (Scene[i][x] == 0) {
                        Boxes[i * 15 + x].style.backgroundColor = "white";
                    } else if (Scene[i][x] == 1) {
                        Boxes[i * 15 + x].style.backgroundColor = "yellow";
                    } else if (Scene[i][x] == 2) {
                        Boxes[i * 15 + x].style.backgroundColor = "green";
                    } else if (Scene[i][x] == 3) {
                        Boxes[i * 15 + x].style.backgroundColor = "red";
                    }
                };
            };

            // Main part - Infinite loop
            var Game = function () {
                // Replace button with score
                document.getElementById("Start").remove();
                var ScoreText = document.createElement("p");
                ScoreText.innerText = "Score: " + TailLength;
                document.body.appendChild(ScoreText);

                var Die = function () {
                    clearInterval(Play);
                    ScoreText.remove();
                    var Restart = document.createElement("button");
                    Restart.setAttribute("id", "Start"); // So that "document.getElementById("Start").remove();" (line 130) doesn't panic
                    Restart.setAttribute("type", "button");
                    Restart.innerText = "Restart";
                    Restart.style.marginTop = "2%";
                    Restart.addEventListener("click", Game);
                    document.body.appendChild(Restart);
                    for (var i = 0; i < Scene.length; i++) {
                        for (var x = 0; x < Scene[i].length; x++) {
                            Scene[i][x] = 0;
                        }
                    }
                    TailLength = 0;
                    Tails.splice(0, Tails.length);
                    Scene[Math.floor(Scene.length/2)][Math.floor(Scene[Math.floor(Scene.length/2)].length/2)] = 2;
                    CreateFood();
                };
                
                var Play = setInterval(function () {
                    window.addEventListener("keypress", function (e) { // Change direction
                        if (e.key == "w") {
                            Direction = "w";
                        } else if (e.key == "a") {
                            Direction = "a";
                        } else if (e.key == "s") {
                            Direction = "s";
                        } else if (e.key == "d") {
                            Direction = "d";
                        }
                    });

                    for (var i = 0; i < Scene.length; i++) { // Move head and grow tail
                        for (var x = 0; x < Scene[i].length; x++) {
                            if (Scene[i][x] == 2) {
                                if (Direction == "w") { // Collisions in the direction
                                    if (!(i == 0)) {
                                        if (Scene[i - 1][x] == 3) {
                                            TailLength++;
                                            CreateFood();
                                        } else if (Scene[i - 1][x] == 1) {
                                            Die();
                                        }
                                    } else {
                                        if (Scene[Scene.length - 1][x] == 3) {
                                            TailLength++;
                                            CreateFood();
                                        }
                                    }
                                } else if (Direction == "a") {
                                    if (!(x == 0)) {
                                        if (Scene[i][x - 1] == 3) {
                                            TailLength++;
                                            CreateFood();
                                        }
                                    } else {
                                        if (Scene[i][Scene[i].length - 1] == 3) {
                                            TailLength++;
                                            CreateFood();
                                        }
                                    }
                                } else if (Direction == "s") {
                                    if (!(i == Scene.length - 1)) {
                                        if (Scene[i + 1][x] == 3) {
                                            TailLength++;
                                            CreateFood();
                                        }
                                    } else {
                                        if (Scene[0][x] == 3) {
                                            TailLength++;
                                            CreateFood();
                                        }
                                    }
                                } else if (Direction == "d") {
                                    if (!(x == Scene.length - 1)) {
                                        if (Scene[i][x + 1] == 3) {
                                            TailLength++;
                                            CreateFood();
                                        }
                                    } else {
                                        if (Scene[i][0] == 3) {
                                            TailLength++;
                                            CreateFood();
                                        }
                                    }
                                }

                                if (Direction == "w") { // Move in that direction
                                    if (!(i == 0)) { 
                                        Scene[i - 1][x] = 2;
                                    } else {
                                        Scene[Scene.length - 1][x] = 2;
                                    }
                                } else if (Direction == "a") {
                                    if (!(x == 0)) { 
                                        Scene[i][x - 1] = 2;
                                    } else {
                                        Scene[i][Scene[i].length - 1] = 2;
                                    }
                                } else if (Direction == "s") {
                                    if (!(i == Scene.length - 1)) { 
                                        Scene[i + 1][x] = 2;
                                    } else {
                                        Scene[0][x] = 2;
                                    }
                                } else if (Direction == "d") {
                                    if (!(x == Scene.length - 1)) { 
                                        Scene[i][x + 1] = 2;
                                    } else {
                                        Scene[i][0] = 2;
                                    }
                                }

                                Scene[i][x] = 0; // Remove previous head

                                Tails.push({ // Create Tail
                                    Row: i,
                                    Column: x
                                });

                                // End loop
                                x = Scene[i].length;
                                i = Scene.length - 1;
                            }
                        }
                    }

                    if (Tails.length > TailLength) { // Destroy end of tail if too long
                        console.log("Too long " + Tails[0].Row + " " + Tails[0].Column);
                        Scene[Tails[0].Row][Tails[0].Column] = 0; // Replace with white
                        Tails.splice(0, 1);
                    };

                    for (var i = 0; i < Tails.length; i++) { // Draw tails
                        Scene[Tails[i].Row][Tails[i].Column] = 1; // Paint square by Tail'sz coordinate
                        console.log("Tail");
                    };

                    ScoreText.innerText = "Score: " + TailLength;

                    for (var i = 0; i < 15; i++) { // Coloring
                        for (var x = 0; x < 15; x++) {
                            if (Scene[i][x] == 0) {
                                Boxes[i * 15 + x].style.backgroundColor = "white";
                            } else if (Scene[i][x] == 1) {
                                Boxes[i * 15 + x].style.backgroundColor = "yellow";
                            } else if (Scene[i][x] == 2) {
                                Boxes[i * 15 + x].style.backgroundColor = "green";
                                Boxes[i * 15 + x].getBoundingClientRect("");
                            } else if (Scene[i][x] == 3) {
                                Boxes[i * 15 + x].style.backgroundColor = "red";
                            }
                        };
                    };
                }, 250);
            }

            document.getElementById("Start").addEventListener("click", Game);
        </script>
    </body>
</html>